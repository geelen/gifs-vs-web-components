<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>A GIF Odyssey</title><link rel="stylesheet" type="text/css" href="styles/styles.css"></head><body><article><section><div ui-fx="blur2" class="fullscreen"><x-gif src="images/stars.gif" fill speed="0.6" stopped></x-gif></div><div class="content"><h1>GIFs vs Web Components</h1><div class="mid">by</div><div class="line"><div class="me"></div><h3>@GlenMaddern</h3></div></div></section><section class="content"><h1>Story time</h1></section><section class="content"><h1>How did I get started?</h1></section><section class="content"><h3><span class="buildin">"Series</span><span class="buildin">-of</span><span class="buildin">-dumb</span><span class="buildin">-decisions</span><span class="buildin">-that</span><span class="buildin">-surprisingly</span><span class="buildin">-result</span><span class="buildin">-in</span><span class="buildin">-working</span><span class="buildin">-software"</span></h3></section><section><div class="fullscreen"><x-gif src="images/2012_fire.gif" fill speed="1" n-times="1" stopped></x-gif></div><div class="content"><h2>December<strong> 2012</strong></h2></div></section><section class="content"><div class="line"><div class="schwarz"></div><h3>@BenSchwarz</h3></div></section><section class="content"><h1>VastImg</h1><div class="line"><div class="rtomayko"></div><h3>@RTomayko</h3></div></section><section class="content"><h3>vastimg.herokuapp.com/?http://some/file.gif</h3></section><section data-bespoke-state="gif-skull" class="content"></section><section data-bespoke-state="gif-skull-2" class="content"></section><section><div ui-fx="blur1" class="fullscreen"><x-gif src="images/carl_sagan_good.gif" fill n-times="1" stopped></x-gif></div><div class="content wait-for-gif"><h2>Full-screen GIFs</h2><div class="mid">are</div><h1>awesome</h1></div></section><section class="content"><h3>vastimg.herokuapp.com</h3></section><section><div ui-fx="blur2" class="fullscreen"><x-gif src="images/shocked.gif" fill n-times="1" stopped></x-gif></div><div class="content wait-for-gif"><div></div><h1>ETOOMUCHPORN</h1></div></section><section class="content"><h1>Let's keep it SFW</h1></section><section class="content"><div class="mid">What has</div><h3>lots of<strong> GIFs</strong></h3><div class="mid">and is</div><h3>totally<strong> safe for work</strong></h3><div class="mid">?</div></section><section><div class="fullscreen"><x-gif src="images/shaking_head_breaking_bad.gif" fill ping-pong n-times="4" stopped></x-gif></div><div class="content"><h1>Tumblr</h1></div></section><section class="content"><h3>Any<span class="feat"> particular</span> Tumblr</h3><ul><li>• Lots of GIFs</li><li>• Identified SFW/NSFW</li></ul></section><section><div class="fullscreen"><x-gif src="images/okthen.gif" fill n-times="1" stopped></x-gif></div></section><section class="content"><h1>GifCity</h1><div class="line"><div class="schwarz"></div><h4>@BenSchwarz</h4></div><div class="line"><h4>@GlenMaddern</h4><div class="me"></div></div><div class="line"><div class="bieber"></div><h4>@ToolmanTim</h4></div><div class="line"><h4>@NullObject</h4><div class="josh"></div></div></section><section data-bespoke-state="black" class="content"><h1>GifCity</h1><div class="mid">+</div><h1>Tumblr</h1><div class="mid">=</div><h1><img src="images/heart.gif" class="smallish"></h1></section><section class="content"><h4><strong>benschwarz.github.io/gifcity/?t=tumblrs,go,here</strong></h4></section><section><div class="content"><h2>mrdiv</h2></div><iframe data-bespoke-delay-src="http://benschwarz.github.io/gifcity/?t=mrdiv"></iframe></section><section><div class="content"><h2>simpsonsgifs</h2></div><iframe data-bespoke-delay-src="http://benschwarz.github.io/gifcity/?t=simpsonsgifs"></iframe></section><section><div class="content"><h2>skt-na-veia-sempre</h2></div><iframe data-bespoke-delay-src="http://benschwarz.github.io/gifcity/?t=skt-na-veia-sempre"></iframe></section><section class="content"><h1>But we can do<span class="feat"> more</span></h1></section><section><div ui-fx="blur1" class="fullscreen"><x-gif src="images/amazed.gif" fill n-times="1" stopped></x-gif></div></section><section class="content"><div class="mid">What about</div><h1>synching</h1><div class="mid">to</div><h1>music</h1><div class="mid">?</div></section><section class="content nobuild"><h1 class="fadeout">GifCity</h1><div class="line fadeout"><div class="schwarz"></div><h4>@BenSchwarz</h4></div><div class="line"><h4>@GlenMaddern</h4><div class="me"></div></div><div class="line fadeout"><div class="bieber"></div><h4>@ToolmanTim</h4></div><div class="line fadeout"><h4>@NullObject</h4><div class="josh"></div></div></section><section data-bespoke-state="light" class="content"><img src="images/djgif_logo.gif"><h1>DJGif</h1><h4>github.com/geelen/djgif</h4><h4>djgif.com<span class="feat"> (soon)</span></h4></section><section data-bespoke-state="light" class="content"><img src="images/djgif_logo.gif"><div class="mid">=</div><h1>Tumblr</h1><div class="mid">+</div><h1>Rdio</h1></section><section class="content nobuild"><div class="mid">Two challenges:</div><ul><li>• Change speed of GIFs</li><li>• Find beats from music</li></ul><hr></section><section class="content"><pre><code class="language-markup">&lt;img src="probably_cats.gif"&gt;</code></pre><pre><code class="language-javascript">var img = new Image;
img.src = "definitely_cats.gif";</code></pre><h3>Now what?</h3></section><section class="content"><h1 class="red">✖</h1></section><section class="content"><h1>Why not video?</h1><pre><code class="language-javascript">var video = document.createElement('video');
video.autoPlay = true;
video.loop = true;
video.playbackRate = 1.5;
video.src = 'converted.gif.mp4';
</code></pre></section><section class="content"><h1><a target="_blank" href="https://github.com/geelen/djgif/blob/i_dont_want_no_scrubs/elastic-transcoder/app.js#L10">Convert GIFs to video</a></h1></section><section data-bespoke-state="yeahnah" class="content"></section><section class="content"><h1 class="red">✖</h1></section><section class="content"><div class="mid">What is</div><h3><strong>an animation</strong></h3><div class="mid">but a</div><h3><strong>series of<span class="feat"> frames</span></strong></h3><div class="mid">?</div></section><section class="content"><h4>Put the frames in the DOM</h4><pre><code class="language-markup">&lt;div data-frame="0"&gt;
  &lt;img src="frame0.gif"&gt;
  &lt;img src="frame1.gif"&gt;
  &lt;img src="frame2.gif"&gt;
&lt;/div&gt;
</code></pre></section><section class="content"><h4>Show one at a time with CSS</h4><pre><code class="language-css">[data-frame] img {
  opacity: 0;
  position: absolute;
}

[data-frame="0"] img:nth-child(1),
[data-frame="1"] img:nth-child(2),
[data-frame="2"] img:nth-child(3) {
  opacity: 1;
}
</code></pre></section><section class="content"><h4>Cycle through with JS</h4><pre><code class="language-javascript">var animate = function() {
  var currentFrame = calculateFrame();
  framesElement.dataset.frame = currentFrame;
  requestAnimationFrame(animate);
}
animate();
</code></pre></section><section data-bespoke-state="yep" class="content"></section><section class="content"><h1>Break GIF into frames:</h1><pre><code class="language-bash">brew install gifsicle
gifsicle -e cats.gif
# outputs cats.gif.001 cats.gif.002 etc
</code></pre></section><section class="content"><div class="mid">Host Gifsicle?</div><ul><li>• Download from Tumblr</li><li>• Split apart on filesystem</li><li>• Serve... somehow?</li></ul><hr></section><section data-bespoke-state="yeahnah" class="content"></section><section class="content"><div class="mid">Why don't we</div><h3><strong>break apart a<span class="feat"> GIF</span></strong></h3><div class="mid">in the</div><h3><strong>browser?</strong></h3><hr></section><section class="content"><img src="images/emscripten_logo.jpg"><h4>github.com/kripken/emscripten</h4></section><section class="content"><div class="mid">Emscripten:</div><ul><li>• Stubs out the file system</li><li>• Generates a lot of JS</li><li>• Isn't clever about using Browser APIs</li></ul><hr></section><section data-bespoke-state="yeahnah" class="content"></section><section class="content"><h1 class="red">✖</h1></section><section class="content"><h3><strong>What time is it?</strong></h3></section><section><div class="fullscreen"><x-gif src="images/javascript_time_logo.gif" fill n-times="1" stopped></x-gif></div></section><section class="content"><h1>What's in a GIF?</h1><h5><strong><a target="_blank" href="http://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp">http://www.matthewflickinger.com/lab/ whatsinagif/bits_and_bytes.asp</a></strong></h5></section><!--section--><!--  iframe.x10(data-bespoke-delay-src='http://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp')--><section class="content"><img src="images/gif_file_stream.gif"></section><section class="content"><h3><strong>header</strong></h3><h3><strong><span class="feat">frame</span><span class="green"> frame</span><span class="red"> frame</span></strong></h3><h3><strong>footer</strong></h3></section><section class="content"><h3><strong>header<span class="feat"> frame</span> footer</strong></h3><h3><strong>header<span class="green"> frame</span> footer</strong></h3><h3><strong>header<span class="red"> frame</span> footer</strong></h3></section><section class="content"><h1 class="feat">✔</h1></section><section class="content"><pre><code class="language-javascript">var blob = new Blob(
  [ buffer1, buffer2, ... ],
  {type: 'mime/type'}
);
img.src = URL.createObjectURL(blob);
</code></pre></section><section class="content"><pre data-line="8"><code class="language-javascript">var header = gifData.slice(0, startOfFrames);
var footer = gifData.slice(-1);
for (var i = 0; i < indices.length; i++) {
  var frameData = gifData.slice(
    indices[i],
    indices[i+1] || endOfFrames);
  var blob = new Blob(
    [ header, frameData, gifFooter ],
    {type: 'image/gif'});
  frames.push(URL.createObjectURL(blob));
}
</code></pre></section><seciton class="content"><h1><a target="_blank" href="https://github.com/geelen/x-gif/blob/gh-pages/src/exploder.js">exploder.js</a></h1></seciton><section class="content"><h1>Binary in JS<span class="red">!</span></h1></section><section class="content"><pre><code class="language-javascript">var xhr = new XMLHttpRequest();
xhr.open('GET', 'cats.gif', true);
xhr.responseType = 'arraybuffer';
xhr.onload = function () {
  this.reponse; // BINARY GIF MADNESS
}
xhr.send();
</code></pre></section><section class="content"><h1>Same Origin Policy<span class="red">!</span></h1></section><section class="content"><div class="mid">Two options:</div><h3><strong class="feat">CORS</strong> on the server</h3><div class="mid">vs</div><h3><strong class="feat">Proxy</strong> the content behind a domain you control</h3><hr></section><section class="content"><div class="mid">Proxying content?</div><h3>Run your own<strong class="feat"> proxy</strong></h3><div class="mid">vs</div><h3>Use a CDN for<strong class="red"> evil</strong></h3><hr></section><section class="content"><h3><strong><a target="_blank" href="https://console.aws.amazon.com/cloudfront/home?#distribution-settings:EK5BEJUQJT3ZX">CloudFront</a></strong></h3><img src="images/cloudfront.png"></section><section class="content"><h4><strong>djgif.com/<span class="feat">*</span>.gif</strong></h4><div class="mid">=</div><h4><strong>media.tumblr.com/<span class="feat">*</span>.gif</strong></h4></section><section class="content"><h4><strong>djgif.com/<span class="feat">*.*</span></strong></h4><div class="mid">=</div><h4><strong>s3.amazonaws.com/djgif/<span class="feat">*.*</span></strong></h4></section><section><div class="fullscreen"><x-gif src="images/ticked.gif" fill n-times="0.85" speed="1.5" stopped></x-gif></div><div class="content wait-for-gif"><h1>Same Origin Policy</h1><h1>✔</h1></div></section><section class="content"><div class="mid">Recap</div><h4>We can pull down arbitrary GIF data from Tumblr
and split it into frames.
Now it's time to look at<span class="feat"> playback.</span></h4><hr></section><section class="content"><h4>Playback</h4><pre data-line="3"><code class="language-javascript">var animate = function() {
  framesElement.dataset.frame =
    calculateFrame( ... );
  requestAnimationFrame(animate);
}
animate();
</code></pre></section><section data-bespoke-state="light" class="content"><h1>A component!</h1></section><section data-bespoke-state="light" class="content"><img src="images/p-logo.svg"><h1>&lt;x-gif&gt;</h1><h4>geelen.github.io/x-gif</h4></section><section data-bespoke-state="light" class="content"><h6>&lt;img src="images/jump.gif"&gt;</h6><img data-bespoke-delay-src="images/jump.gif" class="two-up"><x-gif src="images/jump.gif" stopped class="two-up"></x-gif><h6>&lt;<span class="feat">x-gif</span> src="images/jump.gif"&gt;</h6></section><section data-bespoke-state="light" class="content"><h6>&lt;x-gif src="images/jump.gif"&gt;</h6><x-gif src="images/jump.gif" speed="1" stopped class="two-up"></x-gif><x-gif src="images/jump.gif" speed="2" stopped class="two-up"></x-gif><h6>&lt;x-gif src="images/jump.gif"<span class="feat"> speed="2"</span>&gt;</h6></section><section data-bespoke-state="light" class="content"><h6>&lt;img src="images/waves.gif"&gt;</h6><img src="images/waves.gif" class="two-up"><img src="images/vectors.gif" class="two-up"><h6>&lt;img src="images/vectors.gif"&gt;</h6></section><section data-bespoke-state="light" class="content nobuild"><h6>&lt;x-gif src="images/waves.gif"<span class="feat"> bpm="140"</span>&gt;</h6><x-gif src="images/waves.gif" bpm="140" stopped class="two-up"></x-gif><x-gif src="images/vectors.gif" bpm="140" stopped class="two-up"></x-gif><h6>&lt;x-gif src="images/vectors.gif<span class="feat"> bpm="140"</span>&gt;</h6></section><section data-bespoke-state="light" class="content nobuild"><h6>&lt;x-gif src="images/waves.gif"<span class="feat"> hard-bpm="140"</span>&gt;</h6><x-gif src="images/waves.gif" hard-bpm="140" stopped class="two-up"></x-gif><x-gif src="images/vectors.gif" hard-bpm="140" stopped class="two-up"></x-gif><h6>&lt;x-gif src="images/vectors.gif<span class="feat"> hard-bpm="140"</span>&gt;</h6></section><section data-bespoke-state="light" class="content nobuild"><h6>&lt;x-gif src="images/jump.gif"</h6><x-gif src="images/jump.gif" stopped class="two-up"></x-gif><x-gif src="images/jump.gif" ping-pong stopped class="two-up"></x-gif><h6>&lt;x-gif src="images/jump.gif<span class="feat"> ping-pong</span>&gt;</h6></section><section data-bespoke-state="light" class="content nobuild"><h6>&lt;x-gif src="images/jump.gif"<span class="feat"> n-times="1"</span>&gt;</h6><x-gif src="images/jump.gif" n-times="1" stopped class="two-up"></x-gif><x-gif src="images/jump.gif" n-times="2" stopped class="two-up"></x-gif><h6>&lt;x-gif src="images/jump.gif<span class="feat"> n-times="2"</span>&gt;</h6></section><section><div class="fullscreen"><x-gif src="images/jump.gif" fill stopped></x-gif></div><div data-bespoke-state="light" class="content nobuild"><h6>&lt;x-gif src="images/jump.gif"<span class="feat"> fill</span>&gt;</h6></div></section><section data-bespoke-state="light" class="content"><div class="mid">X-GIF</div><ul><li>✔ Polymer element</li><li>✔ Angular directive</li><li>• React component</li><li>• Ember component</li></ul><hr></section><section data-bespoke-state="light" class="content"><img src="images/p-logo.svg"><h4>geelen.github.io/x-gif</h4><h4 class="feat">The GIF tag the internet deserves</h4></section><section class="content"><h1>Beat Detection</h1></section><section class="content nobuild"><div class="mid fadeout">Options</div><h3>Do it live</h3><div class="mid fadeout">vs</div><h3 class="fadeout">Do it ahead of time</h3><hr class="fadeout"></section><section class="content"><h1>Web Audio API</h1><h4><strong><a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web_Audio_API">developer.mozilla.org/<br>en-US/docs/Web_Audio_API</a></strong></h4></section><section class="content"><pre data-line="3,8"><code class="language-javascript">var audioContext = new AudioContext(),
  source = audioContext.createBufferSource(),
  analyser = audioContext.createAnalyser(),
  speakers = audioContext.destination;
  
audioContext.decodeAudioData(mp3data, (buffer) => {
  source.buffer = buffer;
  source.connect(analyser);
  analyser.connect(speakers);
})
</code></pre></section><section class="content"><pre><code class="language-javascript">// Once the music is playing
var frequencyData = new Uint8Array(1024);
analyser.getByteFrequencyData(frequencyData);
frequencyData[19]; // Intensity of ~440Hz
</code></pre></section><section class="content"><pre><code class="language-javascript">navigator.getUserMedia({audio: true}, (stream) => {
  var source = audioContext
                  .createMediaStreamSource(stream);
  source.connect(analyser);
  analyser.connect(speakers);
})
</code></pre></section><section class="content"><div class="line"><div class="ruthjohn"></div><h3>@Rumyra</h3></div><h4><a target="_blank" href="http://24ways.org/2013/make-your-browser-dance/#author"><strong>24ways.org/2013/</strong><br>make-your-browser-dance</a></h4></section><section><iframe data-bespoke-delay-src="https://glen.site44.com/frequency.html"></iframe></section><section class="content"><pre data-line="8"><code class="language-javascript">var frequencyData = new Uint8Array(1024),
  beatDetector = // TODO: this.
  
// called within a requestAnimationFrame loop
var calculateFrame = function() {
  analyser.getByteFrequencyData(frequencyData);
  beatDetector.update(frequencyData);
  return beatDetector.howFarThroughBeat();
}
</code></pre></section><section class="content"><h1 class="red">✖</h1></section><section class="content nobuild"><div class="mid fadeout">Options</div><h3 class="fadeout">Do it live</h3><div class="mid fadeout">vs</div><h3>Do it ahead of time</h3><hr class="fadeout"></section><!--a(target="_blank" href='http://djgif.com/?rdio=p7794600&tumblrs=simpsonsgifs')  DEMO--><section class="content"><img src="images/echo_nest_header.png"><h4>developer.echonest.com</h4></section><section class="content"><pre data-line="2"><code class="language-javascript">http://developer.echonest.com/
  api/v4/song/search?
    api_key=API_KEY&
    format=json&
    results=1&
    artist=weezer&
    title=el%20scorcho&
    bucket=audio_summary</code></pre></section><section class="content"><img src="images/search_response.png"></section><section class="content"><img src="images/track_analysis_response.png"></section><section class="content"><div class="mid">EchoNest</div><ul><li>• Search ~ 1kb</li><li>• Analysis ~ 300kb</li><li class="feat">Both require private API key</li></ul><hr></section><section data-bespoke-state="light" class="content"><h1>NodeJS Micro Service!</h1></section><section data-bespoke-state="light" class="content"><pre class="small"><code class="language-javascript">app.get('/search', (req, res) => {
  var url = searchUrl(req.query.artist, req.query.title)
  request.get(url, (err, data) => {
    var track = JSON.parse(data.body);
    var summary = track.response.songs[0].audio_summary;
    request.get(summary.analysis_url, (err, data) => {
      var analysis = JSON.parse(data.body);
      delete analysis.segments;
      delete analysis.tatums;
      track.response.songs[0].analysis = analysis;
      res.send(200, track);
    });
  });
});
</code></pre></section><section data-bespoke-state="light" class="content"><pre><code class="language-javascript">http://djgif-echonest-proxy.herokuapp.com/
  search?artist=weezer&title=el+scorcho</code></pre><ul><li>✔ 55kb</li><li>✔ No API keys on client</li></ul></section><section data-bespoke-state="light" class="content"><h1><a target="_blank" href="https://github.com/geelen/djgif/tree/master/echonest-proxy">echonest-proxy</a></h1></section><section><div class="fullscreen"><x-gif src="images/ticked.gif" fill n-times="0.85" speed="1.5" stopped></x-gif></div><div class="content wait-for-gif"><h1>Beat data for arbitrary tracks</h1><h1>✔</h1></div></section><section class="content nobuild"><div class="mid">Two wins:</div><ul><li>✔ Change speed of GIFs</li><li>✔ Find beats from music</li></ul><hr></section><section class="content nobuild"><hr><h3><strong>How do we match a<span class="feat"> GIF</span> to a<span class="feat"> beat</span></strong></h3><div class="mid">?</div></section><section class="content nobuild"><div class="mid">Find these:</div><ul><li>• How many beats does the GIF span?</li><li>• Which beat are we on?</li><li>• How far through this beat?</li></ul><hr></section><section class="content nobuild"><div class="mid">From these:</div><ul><li>• Duration of the GIF</li><li>• Duration of the beat</li><li>• Number of the beat</li><li>• Fraction through the beat</li></ul><hr></section><section data-bespoke-state="light" class="content"><h6>&lt;x-gif src="images/explosion.gif"<span class="feat"> sync</span>&gt;</h6><pre><code class="language-javascript">var xGif = document.querySelector('x-gif'),
  beats = metadata.beats, //from Echonest proxy
  animationLoop = () => {
    // calculate these three:
    xGif.clock(beatNr, beatDuration, beatFraction);
  };
animationLoop();
</code></pre></section><section data-bespoke-state="light" class="content"><h1><a target="_blank" href="http://localhost:1983/demos/audio2.html">DEMO</a></h1></section><section data-bespoke-state="light" class="content"><img src="images/djgif_logo.gif"><h1>DJGif</h1><h4>Shipped, right?</h4></section><section data-bespoke-state="light" class="content"><h1 class="red">✖</h1></section><section data-bespoke-state="light" class="content"><h1>Side projects</h1><div class="mid">are not</div><h1>products</h1></section><section data-bespoke-state="light" class="content"><ul><li>✔ Binary JS hax</li><li>✔ Cloudfront proxying</li><li>✔ Transcoding GIFs to Video</li><li>✔ Web Audio Analysis API</li><li>✔ Beat synchronisation</li><li>✔ Polymer & Web Components</li></ul></section><section data-bespoke-state="light" class="content"><div class="mid">Next, maybe:</div><ul><li>• Beat detection algorithms</li><li>• RXJS + React</li><li>• GIF mood detection</li></ul><div class="mid">& more dumb things</div></section><section><div ui-fx="blur1" class="fullscreen"><x-gif src="images/carl_sagan_good.gif" fill n-times="1" stopped></x-gif></div><div class="content wait-for-gif"><h1>Dumb ideas</h1><div class="mid">are</div><h1>awesome</h1></div></section><section data-bespoke-state="light" class="content"><h1>Thanks!</h1><div class="line"><div class="me"></div><h3><strong>@GlenMaddern</strong></h3></div><h4><strong>geelen.github.io/a-gif-odyssey</strong></h4></section><section data-bespoke-state="light" class="content"><img src="images/djgif_logo.gif"><h1><a target="_blank" href="http://djgif.com/?rdio=p7794600&amp;tumblrs=mrdiv">DEMO</a></h1></section></article><script src="scripts/scripts.js"></script><script>if ('registerElement' in document
  && 'createShadowRoot' in HTMLElement.prototype
  && 'import' in document.createElement('link')
  && 'content' in document.createElement('template')) {
  // We're using a browser with native WC support!
} else {
  document.write('<script src="x-gif/dist/platform.js"><\/script>')
}</script><link rel="import" href="x-gif/dist/x-gif.raw.html"></body></html>